
const SUPPORTED=['ua','en','ru','de','fr','es'];const DEFAULT='en';
function detectLang(){const s=localStorage.getItem('cso_lang');if(s&&SUPPORTED.includes(s))return s;const n=(navigator.language||'en').split('-')[0].toLowerCase();const l=SUPPORTED.includes(n)?n:DEFAULT;localStorage.setItem('cso_lang',l);return l;}
async function fetchJson(u){try{const r=await fetch(u);if(r.ok)return await r.json()}catch(e){}return null;}
async function loadDict(l){for(const t of [`assets/lang/${l}.json`,`../assets/lang/${l}.json`]){const d=await fetchJson(t);if(d)return d;}return{};}
function i18nFill(d){for(const el of document.querySelectorAll('[data-i18n]')){const k=el.getAttribute('data-i18n').split('.');let v=d;for(const p of k){v=(v||{})[p]}if(typeof v==='string'){el.innerHTML=v}}if(d?.home?.title){document.title=d.home.title}}
function bindLangSelector(cur){const sel=document.getElementById('langSelect');if(!sel)return;const names={ua:'ðŸ‡ºðŸ‡¦ Ð£ÐºÑ€Ð°Ñ—Ð½ÑÑŒÐºÐ°',en:'ðŸ‡¬ðŸ‡§ English',ru:'ðŸ‡·ðŸ‡º Ð ÑƒÑÑÐºÐ¸Ð¹',de:'ðŸ‡©ðŸ‡ª Deutsch',fr:'ðŸ‡«ðŸ‡· FranÃ§ais',es:'ðŸ‡ªðŸ‡¸ EspaÃ±ol'};for(const c of SUPPORTED){const o=document.createElement('option');o.value=c;o.textContent=names[c];sel.appendChild(o)}sel.value=cur;sel.addEventListener('change',()=>{localStorage.setItem('cso_lang',sel.value);location.reload()})}
function setupTheme(){const root=document.documentElement,body=document.body,btn=document.getElementById('themeToggle'),sun=document.getElementById('sunIcon'),moon=document.getElementById('moonIcon');const saved=localStorage.getItem('cso_theme');const prefersDark=window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches;let light=(saved?saved==='light':!prefersDark);root.classList.toggle('light',light);if(light){sun.classList.remove('leave');moon.classList.remove('enter')}else{sun.classList.add('leave');moon.classList.add('enter')}btn.addEventListener('click',()=>{body.classList.add('theme-fade');setTimeout(()=>body.classList.remove('theme-fade'),320);light=!root.classList.contains('light');root.classList.toggle('light',light);localStorage.setItem('cso_theme',light?'light':'dark');if(light){sun.classList.remove('leave');moon.classList.remove('enter');void sun.offsetWidth;moon.style.opacity=0;moon.style.transform='translateY(-18px)';setTimeout(()=>{moon.classList.remove('enter')},10)}else{sun.classList.add('leave');setTimeout(()=>{moon.classList.add('enter')},30)}})}
function highlightActive(){const here=location.pathname.split('/').pop()||'index.html';for(const a of document.querySelectorAll('.navlist a')){const href=a.getAttribute('href');if(href&&href.endsWith(here))a.classList.add('active')}}
document.addEventListener('DOMContentLoaded',async()=>{setupTheme();highlightActive();const lang=detectLang();bindLangSelector(lang);const dict=await loadDict(lang);i18nFill(dict)});
