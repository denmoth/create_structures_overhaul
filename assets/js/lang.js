
const SUPPORTED=['ua','en','ru','de','fr','es'];const DEFAULT='en';
function detectLang(){const s=localStorage.getItem('cso_lang');if(s&&SUPPORTED.includes(s))return s;const n=(navigator.language||'en').split('-')[0].toLowerCase();const l=SUPPORTED.includes(n)?n:DEFAULT;localStorage.setItem('cso_lang',l);return l;}
async function fetchJson(u){try{const r=await fetch(u);if(r.ok)return await r.json()}catch(e){}return null;}
async function loadDict(l){const tries=[`assets/lang/${l}.json`,`../assets/lang/${l}.json`];for(const t of tries){const d=await fetchJson(t);if(d)return d;}return{};}
function i18nFill(d){for(const el of document.querySelectorAll('[data-i18n]')){const k=el.getAttribute('data-i18n');const v=k.split('.').reduce((o,x)=>(o||0)[x],d);if(typeof v==='string')el.innerHTML=v;}}
function bindLangSelector(cur){const sel=document.getElementById('langSelect');if(!sel)return;const names={ua:'Українська',en:'English',ru:'Русский',de:'Deutsch',fr:'Français',es:'Español'};for(const c of SUPPORTED){const o=document.createElement('option');o.value=c;o.textContent=names[c];sel.appendChild(o);}sel.value=cur;sel.addEventListener('change',()=>{localStorage.setItem('cso_lang',sel.value);location.reload();});}
function setupTheme(){const root=document.documentElement;const btn=document.getElementById('themeToggle');const saved=localStorage.getItem('cso_theme');const prefersDark=window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches;const start=saved||(prefersDark?'dark':'light');root.classList.toggle('light',start==='light');btn.textContent=start==='light'?'Dark':'Light';btn.addEventListener('click',()=>{const isLight=root.classList.toggle('light');localStorage.setItem('cso_theme',isLight?'light':'dark');btn.textContent=isLight?'Dark':'Light';});}
function highlightActive(){const here=location.pathname.split('/').pop()||'index.html';for(const a of document.querySelectorAll('.navlist a')){const href=a.getAttribute('href');if(href&&href.endsWith(here))a.classList.add('active');}}
document.addEventListener('DOMContentLoaded',async()=>{setupTheme();highlightActive();const lang=detectLang();bindLangSelector(lang);const dict=await loadDict(lang);i18nFill(dict);});
